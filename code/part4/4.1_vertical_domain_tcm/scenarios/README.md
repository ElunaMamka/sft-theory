# 真实场景详细示例

这个目录包含了4个真实的SFT调试场景，每个场景都是完整的、可运行的Python脚本，包含大篇幅的解释和演示。

## 🔥 场景列表

### 场景1：数据筛选的多轮迭代
**文件：** `scenario1_data_filtering_iteration.py`  
**时长：** 约5分钟  
**内容：**
- 第一遍规则筛选看似成功
- 第二遍AI打分选出高分数据
- **发现问题**：高分数据仍有安全隐患（方剂剂量、缺少禁忌）
- **回溯修正**：添加新规则，重新筛选所有数据
- 最终对比：28条高质量 > 45条有隐患

**运行：**
```bash
python scenario1_data_filtering_iteration.py
```

**学到什么：**
- AI打分≠真正高质量
- 发现问题要勇于回溯
- 数据质量 > 数据数量

---

### 场景2：模型复读问题
**文件：** `scenario2_model_repetition_problem.py`  
**时长：** 约8分钟  
**内容：**
- 训练完发现模型重复同一句话3次
- **系统诊断**：检查数据、参数、配置
- **根本原因**：26%数据内部有重复 + 未设置repetition_penalty
- **三种方案**：参数修复 vs 数据修复 vs 综合方案
- **效果验证**：复读率从72%降到0%

**运行：**
```bash
python scenario2_model_repetition_problem.py
```

**学到什么：**
- Loss低≠模型好
- 数据修复是根本，参数是辅助
- 系统化诊断流程

---

### 场景3：专业知识缺失
**文件：** `scenario3_knowledge_gap_problem.py`  
**时长：** 约6分钟  
**内容：**
- 测试发现：不管什么症状都诊断为"脾肾阳虚"
- **原因分析**：训练数据中90%都是这个证型
- **数据诊断**：分析证型分布、找到不平衡
- **解决方案**：
  - 补充其他证型数据（每个至少50条）
  - 构造对比样本（区分相似症状）
  - 使用平衡采样（WeightedRandomSampler）
- **效果**：准确率从40%提升到85%

**运行：**
```bash
python scenario3_knowledge_gap_problem.py
```

**学到什么：**
- 数据分布严重影响模型表现
- 不只是数量平衡，还要质量平衡
- 对比样本的重要性

---

### 场景4：从v0.1失败到v1.1成功
**文件：** `scenario4_full_iteration_journey.py`  
**时长：** 约10分钟  
**内容：**
- **v0.1**：完全失败（所有输出都是免责声明）
  - 问题：数据中98%包含免责声明在开头
  - Loss: 0.89（很低）
  - 可用性：0%
  
- **v0.2**：严重复读
  - 问题：数据重复 + 参数未设置
  - 复读率：72%
  - 解决：数据去重 + 设置参数
  
- **v0.3**：判断错误
  - 问题：数据分布不均（90%同一证型）
  - 准确率：40%
  - 解决：数据平衡

- **v1.0**：基本可用
  - 数据：145条高质量
  - 准确率：85%
  
- **v1.1**：效果优秀
  - 细节优化（术语、剂量、禁忌）
  - 准确率：92%

**运行：**
```bash
python scenario4_full_iteration_journey.py
```

**学到什么：**
- 完整的迭代过程（7天）
- 每个版本的问题和解决方案
- 从失败到成功的真实路径

---

## 🚀 如何使用

### 1. 按顺序学习（推荐）

建议按顺序运行，循序渐进理解SFT调试：

```bash
# 第1天：了解数据筛选
python scenario1_data_filtering_iteration.py

# 第2天：了解模型问题诊断
python scenario2_model_repetition_problem.py

# 第3天：了解数据平衡
python scenario3_knowledge_gap_problem.py

# 第4天：完整案例复盘
python scenario4_full_iteration_journey.py
```

### 2. 针对性学习

遇到具体问题时，运行对应场景：

- 不知道如何筛选数据？→ 场景1
- 模型输出有重复？→ 场景2  
- 模型在某些类别表现差？→ 场景3
- 想看完整的项目过程？→ 场景4

### 3. 代码学习

每个场景都是完整的Python代码，包含：
- 详细的注释
- 真实的数据示例
- 完整的诊断流程
- 多种解决方案对比

可以直接阅读代码学习实现细节。

---

## 📊 场景对比

| 场景 | 时长 | 难度 | 重点 | 适合人群 |
|------|------|------|------|----------|
| 场景1 | 5分钟 | ⭐⭐ | 数据筛选 | 数据工程师 |
| 场景2 | 8分钟 | ⭐⭐⭐ | 问题诊断 | 模型调试者 |
| 场景3 | 6分钟 | ⭐⭐⭐ | 数据平衡 | 数据科学家 |
| 场景4 | 10分钟 | ⭐⭐⭐⭐ | 完整流程 | 项目负责人 |

---

## 💡 核心价值

### 为什么要这些详细场景？

1. **真实性**
   - 不是理想化的教程
   - 而是真实会遇到的问题

2. **完整性**
   - 不只是代码
   - 包含完整的思考过程

3. **实用性**
   - 可以直接运行
   - 可以复制到自己的项目

4. **教育性**
   - 详细的解释
   - 多种方案对比
   - 可复用的检查清单

### 与简单示例的区别

**简单示例：**
```python
# 设置repetition_penalty
generation_config["repetition_penalty"] = 1.2
```

**详细场景：**
```python
# 为什么会有复读问题？
# → 检查数据：发现26%有重复
# → 检查参数：未设置repetition_penalty  
# → 检查训练：loss过低可能有问题
#
# 有哪些解决方案？
# → 方案1：只改参数（70分）
# → 方案2：重新训练（85分）
# → 方案3：综合方案（95分）
#
# 为什么选方案3？
# → 对比时间成本、GPU成本、效果
# → 虽然多3.5小时，但彻底解决
```

---

## 🎯 学习路径建议

### 初学者

1. 先看场景4（完整流程），建立全局认知
2. 然后按顺序学场景1-3，深入每个环节
3. 实际项目中遇到问题时，回来查对应场景

### 有经验者

1. 直接针对性学习遇到的问题
2. 对比自己的解决方案和场景中的方案
3. 学习系统化诊断流程

---

## 📚 相关资源

- **父目录README**: `../README.md` - 项目整体说明
- **迭代日志**: `../ITERATION_LOG.md` - 7天完整记录
- **数据筛选**: `../data/data_filtering_pipeline.py` - 完整实现
- **问题诊断**: `../training/problem_diagnosis_and_fix.py` - 诊断工具

---

**💡 记住：真实的SFT项目，90%的时间都在调试和迭代！**

